!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.crossmessenger=e():t.crossmessenger=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";t.exports=n(1)},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a,u,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},p=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(2),h=r(l),v=n(3),d=r(v),_=n(60),y=r(_),g=(u=a=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._send=function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=String(e._idCounter++),i=void 0,s=void 0;i=r?new Promise(function(t){n._waitingForReplyList[o]=t}):Promise.resolve(),t.id=o,t.messageScope=n._messageScope,t.expectReply=r;try{s=JSON.stringify(t),n.emit("send",t),n._targetFrame.postMessage(s,n._targetDomain)}catch(t){throw new Error("Could not serialize message: "+t)}return i},n._setHandshakeSuccess=function(){n._hasHandshake||(n._hasHandshake=!0,n.emit("handshake",n),n._setReadyWhenReady())},n._setDomSuccess=function(){n._isDomReady||(n._isDomReady=!0,n.emit("domready",n),n._setReadyWhenReady(),n._hasHandshake||n.send({name:"_handshake"},!1,!0))},n._handleReceive=function(t){var e=void 0;try{e=JSON.parse(t.data)}catch(t){return}var r=(0,y.default)(e,"messageScope")===n._messageScope&&(0,d.default)(e,"id"),o=r?"_handshake"===(0,y.default)(e,"name"):null,i=r?(0,y.default)(e,"id"):null,s=(0,y.default)(e,"expectReply")===!0,a=(0,d.default)(e,"replyId");if(r&&o&&i&&(a||n.reply(e,!0),setTimeout(n._setHandshakeSuccess.bind(n))),r){var u=((0,y.default)(e,"name"),(0,d.default)(n._waitingForReplyList,(0,y.default)(e,"replyId"))),c=u?n._waitingForReplyList[e.replyId]:null;if(n.emit("receive",e,n),u)c(e),delete n._waitingForReplyList[e.replyId],n.emit("reply",e,n);else{if(s){var p=null,l=!0,h=null;if(n._actionRouter)try{p=n._actionRouter.handleMessage(e,n)}catch(t){t=t.getMessage(),l=!1}n.reply(f({},e,{payload:p,success:l,error:h}))}else n._actionRouter&&n._actionRouter.handleMessage(e,n);n.emit("message",e,n)}}},n._validateConfigAndThrowOnError(t),n._targetFrame=t.targetFrame&&"contentWindow"in t.targetFrame?t.targetFrame.contentWindow:t.targetFrame,n._targetDomain=t.targetDomain,n._messageScope=t.messageScope,n._actionRouter=(0,y.default)(t,"actionRouter"),n._waitingForReplyList={},n._hasHandshake=!1,n._isDomReady=!1,n._isReady=new Promise(function(t,e){n._isReadyResolver=t,n._isReadyRejector=e}),window.addEventListener("message",n._handleReceive),"complete"===document.readyState?setTimeout(n._setDomSuccess.bind(n)):(document.addEventListener("DOMContentLoaded",n._setDomSuccess),window.addEventListener("load",n._setDomSuccess)),n}return s(e,t),p(e,[{key:"reply",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="object"==("undefined"==typeof t?"undefined":c(t))?t:{id:t},r=Object.assign({},n,e,{replyId:n.id});return this.send(r)}},{key:"send",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r?this._send(t,n):this._isReady.then(function(){return e._send(t,n)})}},{key:"_validateConfigAndThrowOnError",value:function(t){var n=["targetFrame","targetDomain","messageScope"];if(n.forEach(function(e){if(!(0,d.default)(t,e))throw new Error('Config property: "'+e+'" is required')}),!t.targetFrame)throw new Error("Invalid target frame");if(e._registeredMessageScopes.indexOf(t.messageScope)!==-1)throw new Error("Invalid message scope: "+t.messageScope+" is not unique")}},{key:"_setReadyWhenReady",value:function(){this._hasHandshake&&this._isDomReady&&(this._isReadyResolver(),this.emit("ready",this))}}]),e}(h.default),a._idCounter=0,a._registeredMessageScopes=[],u);t.exports=g,window.CrossMessenger=g},function(t,e,n){"use strict";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(){this._events=new r,this._eventsCount=0}var s=Object.prototype.hasOwnProperty,a="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(a=!1)),i.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)s.call(t,e)&&n.push(a?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},i.prototype.listeners=function(t,e){var n=a?a+t:t,r=this._events[n];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,s=new Array(i);o<i;o++)s[o]=r[o].fn;return s},i.prototype.emit=function(t,e,n,r,o,i){var s=a?a+t:t;if(!this._events[s])return!1;var u,c,f=this._events[s],p=arguments.length;if(f.fn){switch(f.once&&this.removeListener(t,f.fn,void 0,!0),p){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,e),!0;case 3:return f.fn.call(f.context,e,n),!0;case 4:return f.fn.call(f.context,e,n,r),!0;case 5:return f.fn.call(f.context,e,n,r,o),!0;case 6:return f.fn.call(f.context,e,n,r,o,i),!0}for(c=1,u=new Array(p-1);c<p;c++)u[c-1]=arguments[c];f.fn.apply(f.context,u)}else{var l,h=f.length;for(c=0;c<h;c++)switch(f[c].once&&this.removeListener(t,f[c].fn,void 0,!0),p){case 1:f[c].fn.call(f[c].context);break;case 2:f[c].fn.call(f[c].context,e);break;case 3:f[c].fn.call(f[c].context,e,n);break;case 4:f[c].fn.call(f[c].context,e,n,r);break;default:if(!u)for(l=1,u=new Array(p-1);l<p;l++)u[l-1]=arguments[l];f[c].fn.apply(f[c].context,u)}}return!0},i.prototype.on=function(t,e,n){var r=new o(e,n||this),i=a?a+t:t;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],r]:this._events[i].push(r):(this._events[i]=r,this._eventsCount++),this},i.prototype.once=function(t,e,n){var r=new o(e,n||this,!0),i=a?a+t:t;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],r]:this._events[i].push(r):(this._events[i]=r,this._eventsCount++),this},i.prototype.removeListener=function(t,e,n,o){var i=a?a+t:t;if(!this._events[i])return this;if(!e)return 0===--this._eventsCount?this._events=new r:delete this._events[i],this;var s=this._events[i];if(s.fn)s.fn!==e||o&&!s.once||n&&s.context!==n||(0===--this._eventsCount?this._events=new r:delete this._events[i]);else{for(var u=0,c=[],f=s.length;u<f;u++)(s[u].fn!==e||o&&!s[u].once||n&&s[u].context!==n)&&c.push(s[u]);c.length?this._events[i]=1===c.length?c[0]:c:0===--this._eventsCount?this._events=new r:delete this._events[i]}return this},i.prototype.removeAllListeners=function(t){var e;return t?(e=a?a+t:t,this._events[e]&&(0===--this._eventsCount?this._events=new r:delete this._events[e])):(this._events=new r,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=a,i.EventEmitter=i,t.exports=i},function(t,e,n){function r(t,e){return null!=t&&i(t,e,o)}var o=n(4),i=n(5);t.exports=r},function(t,e){function n(t,e){return null!=t&&o.call(t,e)}var r=Object.prototype,o=r.hasOwnProperty;t.exports=n},function(t,e,n){function r(t,e,n){e=o(e,t);for(var r=-1,f=e.length,p=!1;++r<f;){var l=c(e[r]);if(!(p=null!=t&&n(t,l)))break;t=t[l]}return p||++r!=f?p:(f=null==t?0:t.length,!!f&&u(f)&&a(l,f)&&(s(t)||i(t)))}var o=n(6),i=n(55),s=n(7),a=n(57),u=n(58),c=n(59);t.exports=r},function(t,e,n){function r(t,e){return o(t)?t:i(t,e)?[t]:s(a(t))}var o=n(7),i=n(8),s=n(17),a=n(52);t.exports=r},function(t,e){var n=Array.isArray;t.exports=n},function(t,e,n){function r(t,e){if(o(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!i(t))||(a.test(t)||!s.test(t)||null!=e&&t in Object(e))}var o=n(7),i=n(9),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;t.exports=r},function(t,e,n){function r(t){return"symbol"==typeof t||i(t)&&o(t)==s}var o=n(10),i=n(16),s="[object Symbol]";t.exports=r},function(t,e,n){function r(t){return null==t?void 0===t?u:a:c&&c in Object(t)?i(t):s(t)}var o=n(11),i=n(14),s=n(15),a="[object Null]",u="[object Undefined]",c=o?o.toStringTag:void 0;t.exports=r},function(t,e,n){var r=n(12),o=r.Symbol;t.exports=o},function(t,e,n){var r=n(13),o="object"==typeof self&&self&&self.Object===Object&&self,i=r||o||Function("return this")();t.exports=i},function(t,e){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(e,function(){return this}())},function(t,e,n){function r(t){var e=s.call(t,u),n=t[u];try{t[u]=void 0;var r=!0}catch(t){}var o=a.call(t);return r&&(e?t[u]=n:delete t[u]),o}var o=n(11),i=Object.prototype,s=i.hasOwnProperty,a=i.toString,u=o?o.toStringTag:void 0;t.exports=r},function(t,e){function n(t){return o.call(t)}var r=Object.prototype,o=r.toString;t.exports=n},function(t,e){function n(t){return null!=t&&"object"==typeof t}t.exports=n},function(t,e,n){var r=n(18),o=/^\./,i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,s=/\\(\\)?/g,a=r(function(t){var e=[];return o.test(t)&&e.push(""),t.replace(i,function(t,n,r,o){e.push(r?o.replace(s,"$1"):n||t)}),e});t.exports=a},function(t,e,n){function r(t){var e=o(t,function(t){return n.size===i&&n.clear(),t}),n=e.cache;return e}var o=n(19),i=500;t.exports=r},function(t,e,n){function r(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(i);var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var s=t.apply(this,r);return n.cache=i.set(o,s)||i,s};return n.cache=new(r.Cache||o),n}var o=n(20),i="Expected a function";r.Cache=o,t.exports=r},function(t,e,n){function r(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var o=n(21),i=n(46),s=n(49),a=n(50),u=n(51);r.prototype.clear=o,r.prototype.delete=i,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,t.exports=r},function(t,e,n){function r(){this.size=0,this.__data__={hash:new o,map:new(s||i),string:new o}}var o=n(22),i=n(37),s=n(45);t.exports=r},function(t,e,n){function r(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var o=n(23),i=n(33),s=n(34),a=n(35),u=n(36);r.prototype.clear=o,r.prototype.delete=i,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,t.exports=r},function(t,e,n){function r(){this.__data__=o?o(null):{},this.size=0}var o=n(24);t.exports=r},function(t,e,n){var r=n(25),o=r(Object,"create");t.exports=o},function(t,e,n){function r(t,e){var n=i(t,e);return o(n)?n:void 0}var o=n(26),i=n(32);t.exports=r},function(t,e,n){function r(t){if(!s(t)||i(t))return!1;var e=o(t)?v:c;return e.test(a(t))}var o=n(27),i=n(29),s=n(28),a=n(31),u=/[\\^$.*+?()[\]{}|]/g,c=/^\[object .+?Constructor\]$/,f=Function.prototype,p=Object.prototype,l=f.toString,h=p.hasOwnProperty,v=RegExp("^"+l.call(h).replace(u,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=r},function(t,e,n){function r(t){if(!i(t))return!1;var e=o(t);return e==a||e==u||e==s||e==c}var o=n(10),i=n(28),s="[object AsyncFunction]",a="[object Function]",u="[object GeneratorFunction]",c="[object Proxy]";t.exports=r},function(t,e){function n(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}t.exports=n},function(t,e,n){function r(t){return!!i&&i in t}var o=n(30),i=function(){var t=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();t.exports=r},function(t,e,n){var r=n(12),o=r["__core-js_shared__"];t.exports=o},function(t,e){function n(t){if(null!=t){try{return o.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var r=Function.prototype,o=r.toString;t.exports=n},function(t,e){function n(t,e){return null==t?void 0:t[e]}t.exports=n},function(t,e){function n(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}t.exports=n},function(t,e,n){function r(t){var e=this.__data__;if(o){var n=e[t];return n===i?void 0:n}return a.call(e,t)?e[t]:void 0}var o=n(24),i="__lodash_hash_undefined__",s=Object.prototype,a=s.hasOwnProperty;t.exports=r},function(t,e,n){function r(t){var e=this.__data__;return o?void 0!==e[t]:s.call(e,t)}var o=n(24),i=Object.prototype,s=i.hasOwnProperty;t.exports=r},function(t,e,n){function r(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=o&&void 0===e?i:e,this}var o=n(24),i="__lodash_hash_undefined__";t.exports=r},function(t,e,n){function r(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}var o=n(38),i=n(39),s=n(42),a=n(43),u=n(44);r.prototype.clear=o,r.prototype.delete=i,r.prototype.get=s,r.prototype.has=a,r.prototype.set=u,t.exports=r},function(t,e){function n(){this.__data__=[],this.size=0}t.exports=n},function(t,e,n){function r(t){var e=this.__data__,n=o(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():s.call(e,n,1),--this.size,!0}var o=n(40),i=Array.prototype,s=i.splice;t.exports=r},function(t,e,n){function r(t,e){for(var n=t.length;n--;)if(o(t[n][0],e))return n;return-1}var o=n(41);t.exports=r},function(t,e){function n(t,e){return t===e||t!==t&&e!==e}t.exports=n},function(t,e,n){function r(t){var e=this.__data__,n=o(e,t);return n<0?void 0:e[n][1]}var o=n(40);t.exports=r},function(t,e,n){function r(t){return o(this.__data__,t)>-1}var o=n(40);t.exports=r},function(t,e,n){function r(t,e){var n=this.__data__,r=o(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}var o=n(40);t.exports=r},function(t,e,n){var r=n(25),o=n(12),i=r(o,"Map");t.exports=i},function(t,e,n){function r(t){var e=o(this,t).delete(t);return this.size-=e?1:0,e}var o=n(47);t.exports=r},function(t,e,n){function r(t,e){var n=t.__data__;return o(e)?n["string"==typeof e?"string":"hash"]:n.map}var o=n(48);t.exports=r},function(t,e){function n(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}t.exports=n},function(t,e,n){function r(t){return o(this,t).get(t)}var o=n(47);t.exports=r},function(t,e,n){function r(t){return o(this,t).has(t)}var o=n(47);t.exports=r},function(t,e,n){function r(t,e){var n=o(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}var o=n(47);t.exports=r},function(t,e,n){function r(t){return null==t?"":o(t)}var o=n(53);t.exports=r},function(t,e,n){function r(t){if("string"==typeof t)return t;if(s(t))return i(t,r)+"";if(a(t))return f?f.call(t):"";var e=t+"";return"0"==e&&1/t==-u?"-0":e}var o=n(11),i=n(54),s=n(7),a=n(9),u=1/0,c=o?o.prototype:void 0,f=c?c.toString:void 0;t.exports=r},function(t,e){function n(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}t.exports=n},function(t,e,n){var r=n(56),o=n(16),i=Object.prototype,s=i.hasOwnProperty,a=i.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(t){return o(t)&&s.call(t,"callee")&&!a.call(t,"callee")};t.exports=u},function(t,e,n){function r(t){return i(t)&&o(t)==s}var o=n(10),i=n(16),s="[object Arguments]";t.exports=r},function(t,e){function n(t,e){return e=null==e?r:e,!!e&&("number"==typeof t||o.test(t))&&t>-1&&t%1==0&&t<e}var r=9007199254740991,o=/^(?:0|[1-9]\d*)$/;t.exports=n},function(t,e){function n(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}var r=9007199254740991;t.exports=n},function(t,e,n){function r(t){if("string"==typeof t||o(t))return t;var e=t+"";return"0"==e&&1/t==-i?"-0":e}var o=n(9),i=1/0;t.exports=r},function(t,e,n){function r(t,e,n){var r=null==t?void 0:o(t,e);return void 0===r?n:r}var o=n(61);t.exports=r},function(t,e,n){function r(t,e){e=o(e,t);for(var n=0,r=e.length;null!=t&&n<r;)t=t[i(e[n++])];return n&&n==r?t:void 0}var o=n(6),i=n(59);t.exports=r}])});
//# sourceMappingURL=crossmessenger.min.map