!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CrossMessenger=t():e.CrossMessenger=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="dist",t(0)}([function(e,t,n){"use strict";e.exports=n(1)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a,u,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=n(2),h=r(p),v=n(3),d=r(v),_=n(60),y=r(_),g=(u=a=function(e){function t(e){o(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._send=function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=String(t._idCounter++),s=void 0,i=void 0;s=r?new Promise(function(e){n._waitingForReplyList[o]=e}):Promise.resolve(),e.id=o,e.messageScope=n._messageScope,e.expectReply=r;try{i=JSON.stringify(e),n.emit("send",e),n._targetFrame.postMessage(i,n._targetOrigin)}catch(e){throw new Error("Could not serialize message: "+e)}return s},n._setHandshakeSuccess=function(){n._hasHandshake||(n._hasHandshake=!0,n.emit("handshake",n),n._setReadyWhenReady())},n._setDomSuccess=function(){n._isDomReady||(n._isDomReady=!0,n.emit("domready",n),n._setReadyWhenReady(),n._hasHandshake||n.send({name:"_handshake"},!1,!0))},n._handleReceive=function(e){var t=void 0;try{t=JSON.parse(e.data)}catch(e){return}var r=(0,y.default)(t,"messageScope")===n._messageScope&&(0,d.default)(t,"id"),o=r?"_handshake"===(0,y.default)(t,"name"):null,s=r?(0,y.default)(t,"id"):null,i=(0,y.default)(t,"expectReply")===!0,a=(0,d.default)(t,"replyId");if(r&&o&&s&&(a||n.reply(t,!0),setTimeout(n._setHandshakeSuccess.bind(n))),r){var u=((0,y.default)(t,"name"),(0,d.default)(n._waitingForReplyList,(0,y.default)(t,"replyId"))),c=u?n._waitingForReplyList[t.replyId]:null;if(n.emit("receive",t,n),u)c(t),delete n._waitingForReplyList[t.replyId],n.emit("reply",t,n);else{if(i){var l=null,p=!0,h=null;if(n._messageHandler)try{l=n._messageHandler(t,n)}catch(e){e=e.getMessage(),p=!1}n.reply(f({},t,{payload:l,success:p,error:h}))}else n._messageHandler&&n._messageHandler(t,n);n.emit("message",t,n)}}},n._validateConfigAndThrowOnError(e),n._targetFrame=e.targetFrame&&"contentWindow"in e.targetFrame?e.targetFrame.contentWindow:e.targetFrame,n._targetOrigin=(0,y.default)(e,"targetOrigin","*"),n._messageScope=e.messageScope,n._messageHandler=(0,y.default)(e,"messageHandler"),"object"==c(n._messageHandler)&&(n._messageHandler=n._messageHandler.handleMessage),n._waitingForReplyList={},n._hasHandshake=!1,n._isDomReady=!1,n._isReady=new Promise(function(e,t){n._isReadyResolver=e,n._isReadyRejector=t}),window.addEventListener("message",n._handleReceive),"complete"===document.readyState?setTimeout(n._setDomSuccess.bind(n)):(document.addEventListener("DOMContentLoaded",n._setDomSuccess),window.addEventListener("load",n._setDomSuccess)),n}return i(t,e),l(t,[{key:"reply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="object"==("undefined"==typeof e?"undefined":c(e))?e:{id:e},r=Object.assign({},n,t,{replyId:n.id});return this.send(r)}},{key:"send",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r?this._send(e,n):this._isReady.then(function(){return t._send(e,n)})}},{key:"_validateConfigAndThrowOnError",value:function(e){var n=["targetFrame","targetOrigin","messageScope"];if(n.forEach(function(t){if(!(0,d.default)(e,t))throw new Error('Config property: "'+t+'" is required')}),!e.targetFrame)throw new Error("Invalid target frame");if(t._registeredMessageScopes.indexOf(e.messageScope)!==-1)throw new Error("Invalid message scope: "+e.messageScope+" is not unique");if(e.messageHandler){if(!("object"!=c(e.messageHandler)||"handleMessage"in e.messageHandler))throw new Error('Message handler object should contain a "handleMessage" function');if(["object","function"].indexOf(c(e.messageHandler))===-1)throw new Error('Message handler should be a function of an object with a "handleMessage" function...')}}},{key:"_setReadyWhenReady",value:function(){this._hasHandshake&&this._isDomReady&&(this._isReadyResolver(),this.emit("ready",this))}}]),t}(h.default),a._idCounter=0,a._registeredMessageScopes=[],u);e.exports=g},function(e,t,n){"use strict";function r(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(){this._events=new r,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,a="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(a=!1)),s.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)i.call(e,t)&&n.push(a?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},s.prototype.listeners=function(e,t){var n=a?a+e:e,r=this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,s=r.length,i=new Array(s);o<s;o++)i[o]=r[o].fn;return i},s.prototype.emit=function(e,t,n,r,o,s){var i=a?a+e:e;if(!this._events[i])return!1;var u,c,f=this._events[i],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,n),!0;case 4:return f.fn.call(f.context,t,n,r),!0;case 5:return f.fn.call(f.context,t,n,r,o),!0;case 6:return f.fn.call(f.context,t,n,r,o,s),!0}for(c=1,u=new Array(l-1);c<l;c++)u[c-1]=arguments[c];f.fn.apply(f.context,u)}else{var p,h=f.length;for(c=0;c<h;c++)switch(f[c].once&&this.removeListener(e,f[c].fn,void 0,!0),l){case 1:f[c].fn.call(f[c].context);break;case 2:f[c].fn.call(f[c].context,t);break;case 3:f[c].fn.call(f[c].context,t,n);break;case 4:f[c].fn.call(f[c].context,t,n,r);break;default:if(!u)for(p=1,u=new Array(l-1);p<l;p++)u[p-1]=arguments[p];f[c].fn.apply(f[c].context,u)}}return!0},s.prototype.on=function(e,t,n){var r=new o(t,n||this),s=a?a+e:e;return this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],r]:this._events[s].push(r):(this._events[s]=r,this._eventsCount++),this},s.prototype.once=function(e,t,n){var r=new o(t,n||this,!0),s=a?a+e:e;return this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],r]:this._events[s].push(r):(this._events[s]=r,this._eventsCount++),this},s.prototype.removeListener=function(e,t,n,o){var s=a?a+e:e;if(!this._events[s])return this;if(!t)return 0===--this._eventsCount?this._events=new r:delete this._events[s],this;var i=this._events[s];if(i.fn)i.fn!==t||o&&!i.once||n&&i.context!==n||(0===--this._eventsCount?this._events=new r:delete this._events[s]);else{for(var u=0,c=[],f=i.length;u<f;u++)(i[u].fn!==t||o&&!i[u].once||n&&i[u].context!==n)&&c.push(i[u]);c.length?this._events[s]=1===c.length?c[0]:c:0===--this._eventsCount?this._events=new r:delete this._events[s]}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=a?a+e:e,this._events[t]&&(0===--this._eventsCount?this._events=new r:delete this._events[t])):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=a,s.EventEmitter=s,e.exports=s},function(e,t,n){function r(e,t){return null!=e&&s(e,t,o)}var o=n(4),s=n(5);e.exports=r},function(e,t){function n(e,t){return null!=e&&o.call(e,t)}var r=Object.prototype,o=r.hasOwnProperty;e.exports=n},function(e,t,n){function r(e,t,n){t=o(t,e);for(var r=-1,f=t.length,l=!1;++r<f;){var p=c(t[r]);if(!(l=null!=e&&n(e,p)))break;e=e[p]}return l||++r!=f?l:(f=null==e?0:e.length,!!f&&u(f)&&a(p,f)&&(i(e)||s(e)))}var o=n(6),s=n(55),i=n(7),a=n(57),u=n(58),c=n(59);e.exports=r},function(e,t,n){function r(e,t){return o(e)?e:s(e,t)?[e]:i(a(e))}var o=n(7),s=n(8),i=n(17),a=n(52);e.exports=r},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){function r(e,t){if(o(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!s(e))||(a.test(e)||!i.test(e)||null!=t&&e in Object(t))}var o=n(7),s=n(9),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=r},function(e,t,n){function r(e){return"symbol"==typeof e||s(e)&&o(e)==i}var o=n(10),s=n(16),i="[object Symbol]";e.exports=r},function(e,t,n){function r(e){return null==e?void 0===e?u:a:c&&c in Object(e)?s(e):i(e)}var o=n(11),s=n(14),i=n(15),a="[object Null]",u="[object Undefined]",c=o?o.toStringTag:void 0;e.exports=r},function(e,t,n){var r=n(12),o=r.Symbol;e.exports=o},function(e,t,n){var r=n(13),o="object"==typeof self&&self&&self.Object===Object&&self,s=r||o||Function("return this")();e.exports=s},function(e,t){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(t,function(){return this}())},function(e,t,n){function r(e){var t=i.call(e,u),n=e[u];try{e[u]=void 0;var r=!0}catch(e){}var o=a.call(e);return r&&(t?e[u]=n:delete e[u]),o}var o=n(11),s=Object.prototype,i=s.hasOwnProperty,a=s.toString,u=o?o.toStringTag:void 0;e.exports=r},function(e,t){function n(e){return o.call(e)}var r=Object.prototype,o=r.toString;e.exports=n},function(e,t){function n(e){return null!=e&&"object"==typeof e}e.exports=n},function(e,t,n){var r=n(18),o=/^\./,s=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,a=r(function(e){var t=[];return o.test(e)&&t.push(""),e.replace(s,function(e,n,r,o){t.push(r?o.replace(i,"$1"):n||e)}),t});e.exports=a},function(e,t,n){function r(e){var t=o(e,function(e){return n.size===s&&n.clear(),e}),n=t.cache;return t}var o=n(19),s=500;e.exports=r},function(e,t,n){function r(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(s);var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],s=n.cache;if(s.has(o))return s.get(o);var i=e.apply(this,r);return n.cache=s.set(o,i)||s,i};return n.cache=new(r.Cache||o),n}var o=n(20),s="Expected a function";r.Cache=o,e.exports=r},function(e,t,n){function r(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}var o=n(21),s=n(46),i=n(49),a=n(50),u=n(51);r.prototype.clear=o,r.prototype.delete=s,r.prototype.get=i,r.prototype.has=a,r.prototype.set=u,e.exports=r},function(e,t,n){function r(){this.size=0,this.__data__={hash:new o,map:new(i||s),string:new o}}var o=n(22),s=n(37),i=n(45);e.exports=r},function(e,t,n){function r(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}var o=n(23),s=n(33),i=n(34),a=n(35),u=n(36);r.prototype.clear=o,r.prototype.delete=s,r.prototype.get=i,r.prototype.has=a,r.prototype.set=u,e.exports=r},function(e,t,n){function r(){this.__data__=o?o(null):{},this.size=0}var o=n(24);e.exports=r},function(e,t,n){var r=n(25),o=r(Object,"create");e.exports=o},function(e,t,n){function r(e,t){var n=s(e,t);return o(n)?n:void 0}var o=n(26),s=n(32);e.exports=r},function(e,t,n){function r(e){if(!i(e)||s(e))return!1;var t=o(e)?v:c;return t.test(a(e))}var o=n(27),s=n(29),i=n(28),a=n(31),u=/[\\^$.*+?()[\]{}|]/g,c=/^\[object .+?Constructor\]$/,f=Function.prototype,l=Object.prototype,p=f.toString,h=l.hasOwnProperty,v=RegExp("^"+p.call(h).replace(u,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=r},function(e,t,n){function r(e){if(!s(e))return!1;var t=o(e);return t==a||t==u||t==i||t==c}var o=n(10),s=n(28),i="[object AsyncFunction]",a="[object Function]",u="[object GeneratorFunction]",c="[object Proxy]";e.exports=r},function(e,t){function n(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}e.exports=n},function(e,t,n){function r(e){return!!s&&s in e}var o=n(30),s=function(){var e=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();e.exports=r},function(e,t,n){var r=n(12),o=r["__core-js_shared__"];e.exports=o},function(e,t){function n(e){if(null!=e){try{return o.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var r=Function.prototype,o=r.toString;e.exports=n},function(e,t){function n(e,t){return null==e?void 0:e[t]}e.exports=n},function(e,t){function n(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}e.exports=n},function(e,t,n){function r(e){var t=this.__data__;if(o){var n=t[e];return n===s?void 0:n}return a.call(t,e)?t[e]:void 0}var o=n(24),s="__lodash_hash_undefined__",i=Object.prototype,a=i.hasOwnProperty;e.exports=r},function(e,t,n){function r(e){var t=this.__data__;return o?void 0!==t[e]:i.call(t,e)}var o=n(24),s=Object.prototype,i=s.hasOwnProperty;e.exports=r},function(e,t,n){function r(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=o&&void 0===t?s:t,this}var o=n(24),s="__lodash_hash_undefined__";e.exports=r},function(e,t,n){function r(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}var o=n(38),s=n(39),i=n(42),a=n(43),u=n(44);r.prototype.clear=o,r.prototype.delete=s,r.prototype.get=i,r.prototype.has=a,r.prototype.set=u,e.exports=r},function(e,t){function n(){this.__data__=[],this.size=0}e.exports=n},function(e,t,n){function r(e){var t=this.__data__,n=o(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():i.call(t,n,1),--this.size,!0}var o=n(40),s=Array.prototype,i=s.splice;e.exports=r},function(e,t,n){function r(e,t){for(var n=e.length;n--;)if(o(e[n][0],t))return n;return-1}var o=n(41);e.exports=r},function(e,t){function n(e,t){return e===t||e!==e&&t!==t}e.exports=n},function(e,t,n){function r(e){var t=this.__data__,n=o(t,e);return n<0?void 0:t[n][1]}var o=n(40);e.exports=r},function(e,t,n){function r(e){return o(this.__data__,e)>-1}var o=n(40);e.exports=r},function(e,t,n){function r(e,t){var n=this.__data__,r=o(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var o=n(40);e.exports=r},function(e,t,n){var r=n(25),o=n(12),s=r(o,"Map");e.exports=s},function(e,t,n){function r(e){var t=o(this,e).delete(e);return this.size-=t?1:0,t}var o=n(47);e.exports=r},function(e,t,n){function r(e,t){var n=e.__data__;return o(t)?n["string"==typeof t?"string":"hash"]:n.map}var o=n(48);e.exports=r},function(e,t){function n(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}e.exports=n},function(e,t,n){function r(e){return o(this,e).get(e)}var o=n(47);e.exports=r},function(e,t,n){function r(e){return o(this,e).has(e)}var o=n(47);e.exports=r},function(e,t,n){function r(e,t){var n=o(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var o=n(47);e.exports=r},function(e,t,n){function r(e){return null==e?"":o(e)}var o=n(53);e.exports=r},function(e,t,n){function r(e){if("string"==typeof e)return e;if(i(e))return s(e,r)+"";if(a(e))return f?f.call(e):"";var t=e+"";return"0"==t&&1/e==-u?"-0":t}var o=n(11),s=n(54),i=n(7),a=n(9),u=1/0,c=o?o.prototype:void 0,f=c?c.toString:void 0;e.exports=r},function(e,t){function n(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}e.exports=n},function(e,t,n){var r=n(56),o=n(16),s=Object.prototype,i=s.hasOwnProperty,a=s.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return o(e)&&i.call(e,"callee")&&!a.call(e,"callee")};e.exports=u},function(e,t,n){function r(e){return s(e)&&o(e)==i}var o=n(10),s=n(16),i="[object Arguments]";e.exports=r},function(e,t){function n(e,t){return t=null==t?r:t,!!t&&("number"==typeof e||o.test(e))&&e>-1&&e%1==0&&e<t}var r=9007199254740991,o=/^(?:0|[1-9]\d*)$/;e.exports=n},function(e,t){function n(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}var r=9007199254740991;e.exports=n},function(e,t,n){function r(e){if("string"==typeof e||o(e))return e;var t=e+"";return"0"==t&&1/e==-s?"-0":t}var o=n(9),s=1/0;e.exports=r},function(e,t,n){function r(e,t,n){var r=null==e?void 0:o(e,t);return void 0===r?n:r}var o=n(61);e.exports=r},function(e,t,n){function r(e,t){t=o(t,e);for(var n=0,r=t.length;null!=e&&n<r;)e=e[s(t[n++])];return n&&n==r?e:void 0}var o=n(6),s=n(59);e.exports=r}])});
//# sourceMappingURL=CrossMessenger.min.map