!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CrossMessenger=t():e.CrossMessenger=t()}(this,function(){return function(e){function t(s){if(n[s])return n[s].exports;var r=n[s]={exports:{},id:s,loaded:!1};return e[s].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="dist",t(0)}([function(e,t,n){"use strict";e.exports=n(1)},function(e,t,n){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a,c,u,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),d=n(2),p=s(d),_=(c=a=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:config,n=e.targetFrame,s=e.targetOrigin,i=void 0===s?"*":s,a=e.messageScope,c=e.messageHandler;r(this,t);var l=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return u.call(l),l._validateConfigAndThrowOnError({targetFrame:n,targetOrigin:i,messageScope:a,messageHandler:c}),l._targetFrame=n&&"contentWindow"in n?n.contentWindow:n,l._targetOrigin=i,l._messageScope=a,l._messageHandler=c,"object"==f(l._messageHandler)&&(l._messageHandler=l._messageHandler.handleMessage),l._waitingForReplyList={},l._hasHandshake=!1,l._isDomReady=!1,l._isReady=new Promise(function(e,t){l._isReadyResolver=e,l._isReadyRejector=t}),window.addEventListener("message",l._handleReceive),"complete"===document.readyState?setTimeout(l._setDomSuccess.bind(l)):(document.addEventListener("DOMContentLoaded",l._setDomSuccess),window.addEventListener("load",l._setDomSuccess)),l}return i(t,e),h(t,[{key:"reply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="object"==("undefined"==typeof e?"undefined":f(e))?e:{id:e},s=Object.assign({},n,t,{replyId:n.id});return this.send(s)}},{key:"send",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return s?this._send(e,n):this._isReady.then(function(){return t._send(e,n)})}},{key:"_validateConfigAndThrowOnError",value:function(e){var n=["targetFrame","targetOrigin","messageScope"];if(n.forEach(function(t){if(!(t in e))throw new Error('Config property: "'+t+'" is required')}),!e.targetFrame)throw new Error("Invalid target frame");if(t._registeredMessageScopes.indexOf(e.messageScope)!==-1)throw new Error("Invalid message scope: "+e.messageScope+" is not unique");if(e.messageHandler){if(!("object"!=f(e.messageHandler)||"handleMessage"in e.messageHandler))throw new Error('Message handler object should contain a "handleMessage" function');if(["object","function"].indexOf(f(e.messageHandler))===-1)throw new Error('Message handler should be a function of an object with a "handleMessage" function...')}}},{key:"_setReadyWhenReady",value:function(){this._hasHandshake&&this._isDomReady&&(this._isReadyResolver(),this.emit("ready",this))}}]),t}(p.default),a._idCounter=0,a._registeredMessageScopes=[],u=function(){var e=this;this._send=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=String(_._idCounter++),r=void 0,o=void 0;r=n?new Promise(function(t){e._waitingForReplyList[s]=t}):Promise.resolve(),t.id=s,t.messageScope=e._messageScope,t.expectReply=n;try{o=JSON.stringify(t),e.emit("send",t),e._targetFrame.postMessage(o,e._targetOrigin)}catch(e){throw new Error("Could not serialize message: "+e)}return r},this._setHandshakeSuccess=function(){e._hasHandshake||(e._hasHandshake=!0,e.emit("handshake",e),e._setReadyWhenReady())},this._setDomSuccess=function(){e._isDomReady||(e._isDomReady=!0,e.emit("domready",e),e._setReadyWhenReady(),e._hasHandshake||e.send({name:"_handshake"},!1,!0))},this._handleReceive=function(t){var n=void 0;try{n=JSON.parse(t.data)}catch(e){return}var s=n,r=s.id,o=s.messageScope,i=s.name,a=s.expectReply,c=s.replyId,u=o===e._messageScope&&!!r,f=u&&"_handshake"===i,h=!!c;if(u&&f&&r&&(h||e.reply(n,!0),setTimeout(e._setHandshakeSuccess.bind(e))),u){var d=c in e._waitingForReplyList,p=d?e._waitingForReplyList[c]:null;if(e.emit("receive",n,e),d)p(n),delete e._waitingForReplyList[c],e.emit("reply",n,e);else{if(a){var _=null,v=!0,y=null;if(e._messageHandler)try{_=e._messageHandler(n,e)}catch(e){e=e.getMessage(),v=!1}e.reply(l({},n,{payload:_,success:v,error:y}))}else e._messageHandler&&e._messageHandler(n,e);e.emit("message",n,e)}}}},c);e.exports=_},function(e,t,n){"use strict";function s(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(){this._events=new s,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,a="~";Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(a=!1)),o.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)i.call(e,t)&&n.push(a?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},o.prototype.listeners=function(e,t){var n=a?a+e:e,s=this._events[n];if(t)return!!s;if(!s)return[];if(s.fn)return[s.fn];for(var r=0,o=s.length,i=new Array(o);r<o;r++)i[r]=s[r].fn;return i},o.prototype.emit=function(e,t,n,s,r,o){var i=a?a+e:e;if(!this._events[i])return!1;var c,u,l=this._events[i],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,s),!0;case 5:return l.fn.call(l.context,t,n,s,r),!0;case 6:return l.fn.call(l.context,t,n,s,r,o),!0}for(u=1,c=new Array(f-1);u<f;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var h,d=l.length;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),f){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,s);break;default:if(!c)for(h=1,c=new Array(f-1);h<f;h++)c[h-1]=arguments[h];l[u].fn.apply(l[u].context,c)}}return!0},o.prototype.on=function(e,t,n){var s=new r(t,n||this),o=a?a+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],s]:this._events[o].push(s):(this._events[o]=s,this._eventsCount++),this},o.prototype.once=function(e,t,n){var s=new r(t,n||this,!0),o=a?a+e:e;return this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],s]:this._events[o].push(s):(this._events[o]=s,this._eventsCount++),this},o.prototype.removeListener=function(e,t,n,r){var o=a?a+e:e;if(!this._events[o])return this;if(!t)return 0===--this._eventsCount?this._events=new s:delete this._events[o],this;var i=this._events[o];if(i.fn)i.fn!==t||r&&!i.once||n&&i.context!==n||(0===--this._eventsCount?this._events=new s:delete this._events[o]);else{for(var c=0,u=[],l=i.length;c<l;c++)(i[c].fn!==t||r&&!i[c].once||n&&i[c].context!==n)&&u.push(i[c]);u.length?this._events[o]=1===u.length?u[0]:u:0===--this._eventsCount?this._events=new s:delete this._events[o]}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=a?a+e:e,this._events[t]&&(0===--this._eventsCount?this._events=new s:delete this._events[t])):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=a,o.EventEmitter=o,e.exports=o}])});
//# sourceMappingURL=CrossMessenger.min.map